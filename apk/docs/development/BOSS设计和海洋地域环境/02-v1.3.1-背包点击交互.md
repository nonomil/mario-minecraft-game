# Step 2: v1.3.1 - èƒŒåŒ…ç‚¹å‡»äº¤äº’ âœ… å·²å®Œæˆ

## ç‰ˆæœ¬ä¿¡æ¯
- **ç‰ˆæœ¬å·**: 1.3.1
- **versionCode**: 39
- **ä¸»é¢˜**: èƒŒåŒ…ç‰©å“ç‚¹å‡»ä½¿ç”¨ï¼ˆé£Ÿç‰©å›è¡€ + ç›”ç”²è£…å¤‡ï¼‰
- **å‰ç½®ç‰ˆæœ¬**: v1.3.0
- **çŠ¶æ€**: âœ… å·²å®Œæˆ (2026-02-14)

## ç›®æ ‡
å®ç°èƒŒåŒ…ä¸­ç‰©å“çš„ç‚¹å‡»äº¤äº’ï¼šç‚¹å‡»é£Ÿç‰©å›è¡€ï¼Œç‚¹å‡»ç›”ç”²è£…å¤‡ç©¿æˆ´ã€‚

## ç°çŠ¶åˆ†æ
- èƒŒåŒ…UIå·²æœ‰å¼¹å‡ºå¼æ˜¾ç¤ºï¼ˆv1.2.24é‡æ„ï¼‰
- ç›”ç”²è£…å¤‡ç³»ç»Ÿå·²å®Œæ•´å®ç°ï¼ˆ`equipArmor`/`unequipArmor` å‡½æ•°å­˜åœ¨ï¼‰
- å½“å‰ç›”ç”²åªèƒ½é€šè¿‡å®ç®±åŒå‡»è£…å¤‡
- é£Ÿç‰©ç‰©å“å·²åœ¨ v1.3.0 ä¸­æ·»åŠ ï¼Œä½†æ— ä½¿ç”¨åŠŸèƒ½

## ä¿®æ”¹æ¸…å•

### 1. ä¿®æ”¹ `src/modules/10-ui.js` - èƒŒåŒ…UIäº¤äº’

**ä¸ºèƒŒåŒ…ç‰©å“æ ¼å­æ·»åŠ ç‚¹å‡»äº‹ä»¶**:

```javascript
// èƒŒåŒ…ç‰©å“ç‚¹å‡»å¤„ç†
function onInventoryItemClick(itemType) {
    // é£Ÿç‰©ç±»å‹å¤„ç†
    if (FOOD_TYPES[itemType]) {
        useFoodItem(itemType);
        return;
    }
    // ç›”ç”²ç±»å‹å¤„ç†
    if (itemType.startsWith('armor_')) {
        const armorType = itemType.replace('armor_', '');
        if (ARMOR_TYPES[armorType]) {
            equipArmorFromInventory(armorType);
            return;
        }
    }
}
```

### 2. ä¿®æ”¹ `src/modules/16-events.js` - é£Ÿç‰©ä½¿ç”¨é€»è¾‘

**æ–°å¢é£Ÿç‰©ä½¿ç”¨å‡½æ•°**:

```javascript
function useFoodItem(foodType) {
    const food = FOOD_TYPES[foodType];
    if (!food) return;

    // æ£€æŸ¥ï¼šç”Ÿå‘½å€¼å·²æ»¡ä¸èƒ½ä½¿ç”¨
    if (player.hp >= player.maxHp) {
        showFloatingText('â¤ï¸ ç”Ÿå‘½å€¼å·²æ»¡', player.x, player.y - 30, '#FFD700');
        return;
    }

    // æ£€æŸ¥ï¼šå†·å´ä¸­ï¼ˆ3ç§’å†·å´é˜²è¯¯ç‚¹ï¼‰
    if (player.foodCooldown > 0) {
        showFloatingText('â³ å†·å´ä¸­', player.x, player.y - 30, '#999');
        return;
    }

    // æ£€æŸ¥ï¼šèƒŒåŒ…ä¸­æœ‰è¯¥é£Ÿç‰©
    if (!inventory[foodType] || inventory[foodType] <= 0) return;

    // æ¶ˆè€—é£Ÿç‰©
    inventory[foodType]--;
    if (inventory[foodType] <= 0) delete inventory[foodType];

    // å›è¡€
    player.hp = Math.min(player.hp + food.heal, player.maxHp);

    // è®¾ç½®å†·å´ï¼ˆ3ç§’ = 180å¸§ @60fpsï¼‰
    player.foodCooldown = 180;

    // è§†è§‰åé¦ˆ
    showFloatingText(`+${food.heal} â¤ï¸`, player.x, player.y - 30, '#FF4444');

    // éŸ³æ•ˆåé¦ˆ
    playSound('eat'); // æˆ–ä½¿ç”¨ç°æœ‰éŸ³æ•ˆ

    // æ›´æ–°èƒŒåŒ…UI
    updateInventoryUI();
}
```

### 3. ä¿®æ”¹ `src/modules/13-game-loop.js` - å†·å´è®¡æ—¶

**åœ¨æ¸¸æˆä¸»å¾ªç¯çš„ update é˜¶æ®µæ·»åŠ å†·å´å€’è®¡æ—¶**:

```javascript
// é£Ÿç‰©ä½¿ç”¨å†·å´
if (player.foodCooldown > 0) {
    player.foodCooldown--;
}
```

### 4. ä¿®æ”¹ `src/modules/10-ui.js` - èƒŒåŒ…UIè§†è§‰åé¦ˆ

**é£Ÿç‰©æ»¡è¡€æ—¶ç°æ˜¾ï¼Œå†·å´æ—¶åŠé€æ˜**:

```javascript
// æ¸²æŸ“èƒŒåŒ…æ ¼å­æ—¶
function renderInventorySlot(itemType, count, x, y) {
    // ... ç°æœ‰æ¸²æŸ“é€»è¾‘ ...

    // é£Ÿç‰©ç‰¹æ®ŠçŠ¶æ€
    if (FOOD_TYPES[itemType]) {
        if (player.hp >= player.maxHp) {
            ctx.globalAlpha = 0.4; // æ»¡è¡€ç°æ˜¾
        } else if (player.foodCooldown > 0) {
            ctx.globalAlpha = 0.5; // å†·å´åŠé€æ˜
        }
    }

    // ... ç»˜åˆ¶å›¾æ ‡ ...
    ctx.globalAlpha = 1.0; // æ¢å¤
}
```

### 5. ç›”ç”²ä»èƒŒåŒ…è£…å¤‡

**æ–°å¢ä»èƒŒåŒ…è£…å¤‡ç›”ç”²çš„å‡½æ•°**:

```javascript
function equipArmorFromInventory(armorType) {
    const armorKey = 'armor_' + armorType;

    // æ£€æŸ¥èƒŒåŒ…ä¸­æ˜¯å¦æœ‰è¯¥ç›”ç”²
    if (!inventory[armorKey] || inventory[armorKey] <= 0) return;

    // æ¶ˆè€—èƒŒåŒ…ä¸­çš„ç›”ç”²
    inventory[armorKey]--;
    if (inventory[armorKey] <= 0) delete inventory[armorKey];

    // è°ƒç”¨ç°æœ‰çš„è£…å¤‡å‡½æ•°
    equipArmor(armorType);

    // åé¦ˆ
    showFloatingText(`ğŸ›¡ï¸ è£…å¤‡ ${ARMOR_TYPES[armorType].name || armorType}`,
                     player.x, player.y - 30, ARMOR_TYPES[armorType].color);
    playSound('equip');

    updateInventoryUI();
}
```

## æµ‹è¯•è¦ç‚¹

1. æ‰“å¼€èƒŒåŒ…ï¼Œç‚¹å‡»é£Ÿç‰© â†’ å›è¡€1é¢—å¿ƒï¼Œæ•°é‡-1
2. æ»¡è¡€æ—¶ç‚¹å‡»é£Ÿç‰© â†’ æ˜¾ç¤º"ç”Ÿå‘½å€¼å·²æ»¡"ï¼Œä¸æ¶ˆè€—
3. ä½¿ç”¨é£Ÿç‰©å3ç§’å†…å†ç‚¹ â†’ æ˜¾ç¤º"å†·å´ä¸­"
4. é£Ÿç‰©ç”¨å®Œå â†’ å›¾æ ‡ä»èƒŒåŒ…æ¶ˆå¤±
5. ç‚¹å‡»ç›”ç”² â†’ è§’è‰²ç©¿ä¸Šç›”ç”²ï¼ŒèƒŒåŒ…æ•°é‡-1
6. å·²ç©¿ç›”ç”²æ—¶ç‚¹å‡»æ–°ç›”ç”² â†’ æ›¿æ¢æ—§ç›”ç”²
7. ç›”ç”²5åˆ†é’Ÿå€’è®¡æ—¶æ­£å¸¸å·¥ä½œ
8. å…¶ä»–ç‰©å“ï¼ˆé“å—ã€å—ç“œå¤´ç­‰ï¼‰ç‚¹å‡»æš‚æ— ååº”ï¼ˆv1.3.2å®ç°ï¼‰

## æäº¤ä¿¡æ¯

```
feat: èƒŒåŒ…ç‰©å“ç‚¹å‡»äº¤äº’ - é£Ÿç‰©å›è¡€ä¸ç›”ç”²è£…å¤‡ (v1.3.1)

- ç‚¹å‡»é£Ÿç‰©å›è¡€1é¢—å¿ƒï¼Œ3ç§’å†·å´é˜²è¯¯ç‚¹
- æ»¡è¡€æ—¶é£Ÿç‰©ç°æ˜¾ä¸å¯ç”¨
- ç‚¹å‡»ç›”ç”²ä»èƒŒåŒ…è£…å¤‡ç©¿æˆ´
- æ–°ç›”ç”²æ›¿æ¢æ—§ç›”ç”²
```
