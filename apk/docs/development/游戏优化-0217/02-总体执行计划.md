# 游戏优化-0217 总体执行计划

日期：2026-02-17
基线版本：v1.15.7（versionCode 98）

---

## 一、版本规划总览

| 阶段 | 版本号 | versionCode | 类型 | 核心内容 |
|------|--------|-------------|------|---------|
| P0 | v1.16.0 | 99 | MINOR | 乱码治理 + BOSS单轨化 + 树碰撞修复 + BOSS场景锁定 |
| P1 | v1.17.0 | 100 | MINOR | 群系难度分级 + 群系时长 + 海洋生态 + 火山贴地 + 单词UI |
| P2 | v1.18.0 | 101 | MINOR | 凋零重绘 + 攻击视觉 + 其他BOSS优化 |
| P3 | v1.18.1 | 102 | PATCH | 联调收尾 + 回归测试 + 文档闭环 |

---

## 二、每个版本的标准交付流程

每个阶段（P0/P1/P2/P3）完成后，按以下步骤交付：

```
1. 代码修改 → 功能实现
2. Playwright 测试 → 验证功能
3. 更新版本号
   - apk/package.json → version 字段
   - apk/android-app/package.json → version 字段（CI 发布版本源）
   - apk/android-app/android/app/build.gradle → versionName + versionCode
4. 更新版本记录
   - apk/docs/version/Progress.md → 顶部插入新版本条目
   - apk/docs/version/CHANGELOG.md → 顶部插入新版本条目
   - apk/docs/version/VERSION-STATUS.md → 替换为新版本状态
5. 更新总体计划进度 → 本文档"进度追踪"章节
6. Git 提交 → git add + git commit
7. 推送 → git push（触发 CI 构建 APK）
```

---

## 三、测试策略

### 测试框架
- Playwright（已有 `tests/` 目录，当前基础 8 个 spec 文件）
- 测试入口：`npm test`（根目录）

### 各阶段测试用例规划

#### P0 测试（v1.16.0）
| 测试文件 | 验证内容 |
|---------|---------|
| `tests/p0-encoding.spec.js` | 加载游戏 → 切换到沙漠/山地/火山群系 → 截图验证 toast 无乱码 |
| `tests/p0-tree-collision.spec.js` | 玩家向右碰树 → 向左移动 → 验证可以脱困（位置变化） |
| `tests/p0-boss-single-track.spec.js` | 触发 BOSS 战 → 验证 bossArena 激活 → 验证视口锁定 |

#### P1 测试（v1.17.0）
| 测试文件 | 验证内容 |
|---------|---------|
| `tests/p1-biome-difficulty.spec.js` | 首轮樱花群系 → 验证敌人种类受限；模拟高分重入 → 验证敌人增加 |
| `tests/p1-biome-stay.spec.js` | 进入蘑菇群系 → 短时间内不切换 → 验证最小停留生效 |
| `tests/p1-ocean-ecology.spec.js` | 进入海洋 → 验证无树木 → 验证无苦力怕 → 验证水生实体存在 |
| `tests/p1-challenge-ui.spec.js` | 触发长词挑战 → 截图验证不溢出 → 触发双空补全 → 验证间隔显示 |

#### P2 测试（v1.18.0）
| 测试文件 | 验证内容 |
|---------|---------|
| `tests/p2-wither-boss.spec.js` | 触发凋零 → 验证三头渲染 → 验证阶段切换 → 验证投射物样式 |
| `tests/p2-boss-visual.spec.js` | 逐一触发4个BOSS → 截图对比验证视觉更新 |

#### P3 测试（v1.18.1）
| 测试文件 | 验证内容 |
|---------|---------|
| 复用全部 P0-P2 测试 | 全量回归 |
| `tests/biomes-fullrun.spec.js`（已有） | 全群系遍历无崩溃 |

---

## 四、进度追踪

| 阶段 | 状态 | 开始日期 | 完成日期 | 版本号 | 测试结果 | Git Commit |
|------|------|---------|---------|--------|---------|-----------|
| P0 | ✅ 已完成 | 2026-02-17 | 2026-02-17 | v1.16.0 | p0-stability.spec.js | 待提交 |
| P1 | ✅ 已完成 | 2026-02-17 | 2026-02-17 | v1.17.0 | p1-experience.spec.js | 待提交 |
| P2 | ⬜ 待开始 | - | - | v1.18.0 | - | - |
| P3 | ⬜ 待开始 | - | - | v1.18.1 | - | - |

> 状态更新规则：仅在“代码合并 + 测试通过 + 版本文件更新 + Git commit 完成”后，才可把阶段或子任务从 `⬜` 改为 `✅`。
>  
> 接口一致性规则：执行各阶段时，以当前代码真实 API 为准（例如 `bossArena.boss`、`enter(...)` / `onVictory()` / `exit()`），若计划文档与代码不一致，先修正文档再实施。

### P0 子任务进度
| 任务 | 状态 | 涉及文件 |
|------|------|---------|
| P0-1 乱码治理 | ✅ | `Game.html`, `06-biome.js`, `build-singlefile.js` |
| P0-2 BOSS单轨化 | ✅ | `13-game-loop.js`, `15-entities-boss.js`, `14-renderer-main.js` |
| P0-3 树碰撞修复 | ✅ | `13-game-loop.js` |
| P0-4 BOSS场景锁定 | ✅ | `13-game-loop.js`, `15-entities-boss.js` |
| P0-T 测试通过 | ✅ | `tests/p0-*.spec.js` |
| P0-V 版本发布 | ✅ | `apk/package.json`, `apk/android-app/android/app/build.gradle`, `apk/docs/version/Progress.md`, `apk/docs/version/CHANGELOG.md`, `apk/docs/version/VERSION-STATUS.md` |

### P1 子任务进度
| 任务 | 状态 | 涉及文件 |
|------|------|---------|
| P1-1 群系难度分级 | ✅ | `biomes.json`, `06-biome.js`, `11-game-init.js`, `20-enemies-new.js` |
| P1-2 群系时长调整 | ✅ | `06-biome.js`, `biomes.json` |
| P1-3 海洋生态修正 | ✅ | `15-entities-combat.js`, `11-game-init.js`, `21-decorations-new.js` |
| P1-4 火山贴地修正 | ✅ | `21-decorations-new.js`, `11-game-init.js` |
| P1-5 单词挑战UI | ✅ | `12-challenges.js`, `styles.css` |
| P1-T 测试通过 | ✅ | `tests/p1-*.spec.js` |
| P1-V 版本发布 | ✅ | 版本文件 |

### P2 子任务进度
| 任务 | 状态 | 涉及文件 |
|------|------|---------|
| P2-1 凋零重构 | ⬜ | `15-entities-boss.js`, `14-renderer-entities.js` |
| P2-2 其他BOSS优化 | ⬜ | `15-entities-boss.js` |
| P2-T 测试通过 | ⬜ | `tests/p2-wither-boss.spec.js`, `tests/p2-boss-visual.spec.js` |
| P2-V 版本发布 | ⬜ | `apk/package.json`, `apk/android-app/package.json`, `apk/android-app/android/app/build.gradle`, `apk/docs/version/Progress.md`, `apk/docs/version/CHANGELOG.md`, `apk/docs/version/VERSION-STATUS.md` |

### P3 子任务进度
| 任务 | 状态 | 涉及文件 |
|------|------|---------|
| P3-1 调试页更新 | ⬜ | `GameDebug.html` |
| P3-2 全量回归 | ⬜ | 全部测试文件 |
| P3-3 文档回填 | ⬜ | 本目录文档 |
| P3-V 版本发布 | ⬜ | 版本文件 |

---

## 五、版本文件修改模板

### package.json 修改
```json
{
  "version": "1.16.0"  // ← 对应阶段版本号
}
```

### build.gradle 修改
```gradle
defaultConfig {
    versionCode 99          // ← 递增
    versionName "1.16.0"    // ← 对应阶段版本号
}
```

### Progress.md 顶部插入格式
```markdown
## v1.16.0（发布日期：2026-02-XX）
- 类型：MINOR
- APK 版本：versionName = 1.16.0，versionCode = 99
- 主要变更
  - [具体变更列表]
```

### CHANGELOG.md 顶部插入格式
```markdown
## v1.16.0 (2026-02-XX)

### [变更类别]
- [具体变更描述]

---
```

### VERSION-STATUS.md 替换为
```markdown
# v1.16.0 版本状态

## 已完成
### 1) 版本号同步
- `apk/package.json`: `1.16.0`
- `build.gradle`: `versionName "1.16.0"`, `versionCode 99`

### 2) [具体完成项]
...

---
更新时间：2026-02-XX
状态：已完成
```

### Git 提交格式
```bash
git add [相关文件]
git commit -m "release(v1.16.0): [一句话概述]"
git push origin main
```

---

## 六、详细执行计划索引

| 文档 | 内容 |
|------|------|
| `03-P0-执行计划.md` | P0 稳定性止血：逐步骤代码修改 + 测试 + 发版 |
| `04-P1-执行计划.md` | P1 主体验优化：逐步骤代码修改 + 测试 + 发版 |
| `05-P2-执行计划.md` | P2 BOSS世界观一致化：逐步骤代码修改 + 测试 + 发版 |
| `06-P3-执行计划.md` | P3 联调收尾：回归测试 + 文档闭环 + 发版 |
