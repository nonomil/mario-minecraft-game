# 未实现与偏差汇总（对照 `apk/docs/development/版本计划`）

编制日期：2026-02-16（初版）
更新日期：2026-02-16（二次审计，补充根目录代码对照）
审计范围：同时对照 `apk/` 目录与仓库根目录 `src/modules/` 代码。
路径口径：版本计划文档写的 `src/...` 对应根目录 `src/...`，APK 侧对应 `apk/src/...`。

## 关键发现：根目录与 apk/ 代码不同步

根目录 `src/modules/` 已实现 v1.12.0~v1.15.0 的大部分功能，但 `apk/src/modules/` 尚未同步这些改动。需要执行 `node tools/build-singlefile.js` 或手动同步后才能在 APK 侧生效。

## 版本号一致性（发布步骤偏差）

- `apk/package.json`：`"version": "1.10.3"`
- `apk/android-app/package.json`：`"version": "1.10.2"`
- `apk/android-app/android/app/build.gradle`：`versionName "1.10.2"`, `versionCode 84`

结论：至少存在一次"仅提升了 `apk/` 侧版本号，但 Android App 侧未同步"的发布步骤偏差。

## 实现状态总表（按计划文档）

| 计划文档 | 根目录状态 | apk/ 状态 | 备注 |
|---|---|---|---|
| `01-v1.9.0` BOSS+村庄 | ✅ 已实现 | ✅ 已实现 | BOSS 模块接入、村庄默认开关与旧存档回填。 |
| `02-v1.9.1` 装饰链路 | ✅ 已实现 | ✅ 已实现 | `spawnBiomeDecoration()` 已接入主流程。 |
| `03-v1.9.2` 敌人链路 | ✅ 已实现 | ✅ 已实现 | `spawnBiomeEnemy()` 已接入；新怪渲染分支存在。 |
| `04-v1.9.3` 调试工具 | ✅ 已实现 | ✅ 已实现 | `apk/tests/debug-pages/GameDebug.html` 存在。 |
| `05-v1.10.0` 火山背景 | ✅ 已实现 | ✅ 已实现 | 火山锥形+岩浆坑+烟雾渲染函数存在。 |
| `06-v1.10.1` 深暗增强 | ✅ 已实现 | ✅ 已实现 | Warden、噪音系统、视野限制存在。 |
| `07-v1.10.2` 宝箱经济 | ✅ 已实现 | ✅ 已实现 | `word_card`、`empty` 掉落类型存在。 |
| `08-v1.10.3` 海滨修复 | ❌ 未实现 | ❌ 未实现 | 傀儡限制、尺寸放大、贝壳变体、权重均未落地。 |
| `09-v1.11.0` 蘑菇视觉 | ⚠️ 部分实现 | ⚠️ 部分实现 | 蘑菇树替换已满足；孢子/动画/视觉增强未落地。 |
| `10-v1.11.1` 樱花视觉 | ❌ 未实现 | ❌ 未实现 | 花量/层次/飘落动画/权重调整均未落地。 |
| `11-v1.11.2` 雪傀儡+猪灵 | ❌ 未实现 | ❌ 未实现 | 配方、雪块获取、猪灵权重均未落地。 |
| `12-v1.11.3` 海洋+高温 | ❌ 未实现 | ❌ 未实现 | 高温掉血仍按帧计时（apk 侧）；根目录未找到 biomeHeatDotTimer。 |
| `13-v1.12.0` 学习反馈 | ✅ 已实现 | ❌ 未同步 | 根目录已有 `showChallengeCorrection()`、phrase 提取。apk/ 未同步。 |
| `14-v1.13.0` 算法+题型 | ✅ 已实现 | ❌ 未同步 | 根目录已有质量感知间隔、难度插值。apk/ 未同步。 |
| `15-v1.14.0` UI+性能 | ✅ 已实现 | ❌ 未同步 | 根目录已有词卡时长、频率语义化、ParticlePool。apk/ 未同步。 |
| `16-v1.15.0` 技术清理 | ✅ 已实现 | ❌ 未同步 | 根目录 `optimizedUpdate` 已覆盖装饰/粒子；`src/main.js` 已删除。apk/ 未同步。 |

## 真正未实现的功能清单（后续 TODO）

以下功能在根目录和 apk/ 中均未实现，是真正需要开发的：

### v1.10.3 海滨环境修复（全部未实现）

- [ ] 海滨禁止召唤傀儡：`tryCraft()` 中添加 `currentBiome === "ocean"` 限制
- [ ] 海星尺寸放大：18x18 → 30x30
- [ ] 贝壳尺寸放大：16x10 → 28x18
- [ ] 贝壳多变体渲染：`drawShell()` 按 variant 分支（扇贝/螺旋贝/海螺）
- [ ] 海滨装饰权重提升：shell 0.20→0.28, starfish 0.15→0.22

### v1.11.0 蘑菇森林视觉（部分未实现）

- [x] 蘑菇岛 treeTypes 为 brown_mushroom/red_mushroom（已满足）
- [x] GiantMushroom 类与斑点渲染存在
- [ ] 孢子粒子从伞盖下方飘出
- [ ] 伞盖轻微上下浮动动画
- [ ] 斑点数量增加到 5-8 个

### v1.11.1 樱花丛林视觉（全部未实现）

- [ ] 花瓣数量从 5 增加到 15-20 个
- [ ] 绿色树冠基底 + 多层粉色渐变
- [ ] 花瓣飘落动画
- [ ] 树干花枝细节
- [ ] 装饰权重调整：cherry_tree 提升到 60%，flower_cluster 降到 15%

### v1.11.2 雪傀儡与猪灵（全部未实现）

- [ ] 雪傀儡配方改为 pumpkin×1 + snow_block×2
- [ ] snow_block 物品定义与获取链路（雪堆交互掉落）
- [ ] 猪灵生成权重提升到 30%

### v1.11.3 海洋手感与高温掉血（全部未实现）

- [ ] 高温掉血改为真实时间计时（毫秒累计，60秒扣0.5）
- [ ] 海洋游泳手感调优（慢速上浮/下沉）

## 已在根目录实现但 apk/ 未同步的功能

以下功能已在根目录 `src/modules/` 中实现，只需同步到 `apk/` 即可：

### v1.12.0 学习反馈核心优化

- [x] `showChallengeCorrection()` 函数（`12-challenges.js:396-416`）
- [x] `normalizeRawWord()` 提取 phrase/phraseZh 字段（`09-vocab.js:255-267`）
- [x] 词卡展示例句（`word-card-phrase` 元素）
- [ ] 学习模式答错不扣分+重试（需确认是否已实现）

### v1.13.0 学习算法与题型增强

- [x] 质量感知间隔复习：correct_fast/correct_slow/wrong 三档（`11-game-init.js:116-120`）
- [x] `updateWordQuality()` 方法（`11-game-init.js:175-182`）
- [x] 难度曲线线性插值（`05-difficulty.js:48-60`）
- [ ] 新题型 multi_blank/unscramble（需确认是否已实现）

### v1.14.0 UI+性能优化

- [x] 游戏结束展示本局单词（`10-ui.js:36-51`）
- [x] 词卡时长可配置 `opt-word-card-duration`（`16-events.js:16`）
- [x] 挑战频率语义化 `opt-challenge-frequency`（`16-events.js:15`）
- [x] ParticlePool 对象池 + snowflakePool/leafPool/dustPool（`15-entities-particles.js:134-161`）

### v1.15.0 技术清理

- [x] `optimizedUpdate()` 覆盖装饰和粒子更新（`13-game-loop.js:115,127`）
- [x] `src/main.js` 已删除

## 建议的下一步操作

1. **同步根目录代码到 apk/**：将根目录 `src/modules/` 的最新代码同步到 `apk/src/modules/`，使 v1.12.0~v1.15.0 在 APK 侧生效。
2. **实现 v1.10.3~v1.11.3**：这 5 个版本的功能在两侧均未实现，需要按计划开发。
3. **版本号对齐**：统一 `apk/package.json`、`apk/android-app/package.json`、`build.gradle` 的版本号。
