# 游戏优化-0218-2 下一步计划（Plan）

日期：2026-02-18  
前置文档：`docs/development/游戏优化-0218/游戏优化-0218-2-分析报告.md`

## 目标

1. 先修复 BOSS 战“可见性/可攻击性”致命问题。  
2. 再平衡火山等高压群系停留时长，做到“不太短也不太长”。  
3. 最后做回归验证，确保不引入新回归。

## Phase P0（当天）：BOSS战致命问题修复

### P0-1 修复BOSS渲染坐标链路

涉及文件：
- `src/modules/14-renderer-entities.js`
- `src/modules/14-renderer-main.js`（仅用于复核调用上下文）

动作：
1. 统一“相机偏移只处理一次”的原则。  
2. 在已 `translate(-cameraX, 0)` 的上下文中，BOSS渲染传 `camX=0`（或移除 translate 并保留 `camX=cameraX`，二选一并全链统一）。  

验收：
1. 凋零、恶魂、烈焰人、凋零骷髅均可见。  
2. BOSS弹幕可见，且轨迹与判定一致。  
3. 不再出现“只掉血看不到敌人”。

### P0-2 飞行BOSS可攻击性兜底

涉及文件：
- `src/modules/04-weapons.js`
- `src/modules/15-entities-boss.js`

动作：
1. BOSS开战时检测飞行BOSS + 玩家箭矢不足。  
2. 增加保底策略（二选一）：  
- A. 开战补给最小箭矢（推荐）  
- B. 明确弹窗提示“请切换弓并补充箭矢”

验收：
1. 玩家在飞行BOSS战中始终有可行攻击手段。  
2. 提示信息可读，且不刷屏。

## Phase P1（1天）：群系切换节奏重平衡

### P1-1 参数重平衡（先配置）

涉及文件：
- `config/biomes.json`

建议初始值（首轮）：
1. `switch.stepScore`：200 -> 300  
2. `switch.minStay.volcano`：`{score: 200, timeSec: 40}` -> `{score: 320, timeSec: 70}`  
3. `switch.minStay.nether`：`{score: 250, timeSec: 45}` -> `{score: 360, timeSec: 75}`  
4. 其余群系保持现状，先观察节奏。

验收：
1. 火山停留明显拉长，但不会拖到“疲劳”。  
2. 连续游玩 10 分钟，群系切换节奏仍有变化感。

### P1-2 设置下限保护

涉及文件：
- `Game.html`
- `src/modules/09-vocab.js`
- `src/modules/16-events.js`

动作：
1. 将 `opt-biome-step` 下限从 50 提高到 150 或 200。  
2. `normalizeSettings()` 同步提高最小值，防止旧存档低值污染。

验收：
1. 用户无法将切换周期调到“闪切”区间。  
2. 老存档加载后自动归一到安全值。

## Phase P2（0.5-1天）：BOSS战全量复核

涉及文件：
- `src/modules/15-entities-boss.js`
- `src/modules/13-game-loop.js`
- `src/modules/14-renderer-entities.js`

检查清单：
1. 各BOSS阶段切换提示、无敌帧、伤害判定一致。  
2. 竞技场左右墙限制正常，不会把玩家挤出边界。  
3. 胜利奖励、退场流程、下一个BOSS触发链路正常。  
4. 近战与远程对BOSS命中都能正确扣血。

验收：
1. 四个BOSS都可打、可见、可结算。  
2. 无明显卡死、无渲染错位、无“空受击”。

## Phase P3（0.5天）：回归与记录

动作：
1. 形成回归记录（群系时长、BOSS四战结果、关键截图/日志）。  
2. 更新对应开发文档中的“已完成/待优化”状态。

交付物：
1. 修复提交清单（文件 + 变更摘要）。  
2. 回归结论文档（通过/不通过项）。  
3. 若有遗留问题，列入下一轮 P1/P2 backlog。

## 执行顺序（建议）

1. `P0-1`  
2. `P0-2`  
3. `P1-1`  
4. `P1-2`  
5. `P2`  
6. `P3`

## 风险与回滚

1. 风险：渲染坐标修正后，其他实体可能出现错位。  
回滚：仅回退 `renderBossSystem` 相关变更，保留其余逻辑。  

2. 风险：群系参数过度拉长导致节奏变慢。  
回滚：只回退 `biomes.json` 参数，不回退代码。  

3. 风险：开战补给影响经济平衡。  
回滚：保留提示方案，撤销自动补给。
