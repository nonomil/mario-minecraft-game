# 游戏优化-0217 整体Plan（综述版）

日期：2026-02-17  
范围：`apk/` 主线代码（当前运行入口为 `apk/Game.html` + `apk/src/modules/*`）

## 1. 现状综述（结合代码）

本轮需求主要集中在 6 条主线：

1. 体验正确性：树木碰撞、群系切换节奏、火山地形贴地、BOSS 战进入逻辑。
2. 难度曲线：按积分/轮次分层，不再“首轮过难或多轮同质”。
3. 群系生态一致性：海洋生态元素完整、海洋禁爆、敌人语义合理。
4. 文本可读性：群系提示/系统提示中文乱码治理。
5. 单词挑战可读性：长词与短语不溢出，多空补全显示更自然。
6. BOSS 设计一致性：凋零形象/机制合理化，其它 BOSS 同步收敛。

关键代码观察（已核对）：

- 群系切换已是“分数驱动 + step 循环”：`apk/src/modules/06-biome.js`
- 当前 step 默认 200，且蘑菇岛解锁后会在循环中较快切走：`apk/config/biomes.json`
- 树干碰撞为强阻挡逻辑，确有“左右都被卡死”风险窗口：`apk/src/modules/13-game-loop.js`
- 海洋已限制常规池（`drowned/pufferfish`），但苦力怕爆炸逻辑未加海洋禁爆守卫：`apk/src/modules/11-game-init.js`、`apk/src/modules/15-entities-combat.js`
- BOSS 存在“双系统并行”（旧末影龙 + 新 bossArena）导致体验语义冲突：`apk/src/modules/13-game-loop.js`、`apk/src/modules/15-entities-boss.js`、`apk/src/modules/14-renderer-main.js`
- 挑战词面样式固定大字号+较大字距，长词/短语易溢出：`apk/src/styles.css`、`apk/src/modules/12-challenges.js`
- `apk/Game.html` 存在明显乱码文本，且与 JS 内动态中文混用，属于高优先级编码治理项。

## 2. 总体实施策略

先“止血”（可玩+可读）再“增益”（难度与内容优化）：

- P0（必须先做）：乱码治理、BOSS 单轨化、碰撞卡死修复。
- P1（核心体验）：难度分层与群系节奏、海洋生态修正、单词挑战布局修正。
- P2（内容增强）：凋零与其它 BOSS 的机制与视觉统一优化。
- P3（收尾）：参数调优、回归测试、文档与调试页联动。

## 3. 分阶段 Plan

## P0：稳定性与可读性修复（1-2 天）

目标：先把“看不懂/玩不通”的问题清零。

工作包：

1. 文本编码统一与乱码清理  
涉及：`apk/Game.html`、`apk/src/modules/*`、`apk/docs/*`  
动作：统一 UTF-8（无 BOM），清理已乱码字串，建立“中文文案只在配置/常量定义”规则。

2. BOSS 单轨化  
涉及：`apk/src/modules/13-game-loop.js`、`apk/src/modules/15-entities-boss.js`、`apk/src/modules/14-renderer-main.js`  
动作：移除/下线旧 `ender_dragon` 触发链，只保留 `bossArena`；进入 BOSS 战时明确状态切换（可前进规则、提示规则、HUD 规则一致）。

3. 树碰撞卡死修复  
涉及：`apk/src/modules/13-game-loop.js`  
动作：树干碰撞改为“单侧阻挡 + 脱困容差 + 可回退一小步”，避免出现左右都不可移动。

验收：

- 游戏关键提示无乱码。
- BOSS 提示、血条、实体来源一致，不出现“提示进入但怪未见/场景未锁定”错位。
- 复现“右撞树后左也不能走”场景时已可稳定脱困。

## P1：主体验优化（2-4 天）

目标：把“难度合理、群系合理、题目可读”跑通。

工作包：

1. 群系节奏与动态难度分层  
涉及：`apk/config/biomes.json`、`apk/src/modules/06-biome.js`、`apk/src/modules/11-game-init.js`、`apk/src/modules/20-enemies-new.js`  
动作：  
- 将“首次进入/低分段”与“二轮/高分段”拆层（敌人数、毒伤、精英比例）。  
- 上调或动态化 `stepScore`，并为 `mushroom_island` 增加最短停留门槛（分数或时间门槛）。

2. 海洋生态一致性  
涉及：`apk/src/modules/11-game-init.js`、`apk/src/modules/15-entities-combat.js`、`apk/src/modules/06-biome.js`、`apk/src/modules/21-decorations-new.js`  
动作：  
- 海洋强制禁用苦力怕爆炸伤害。  
- 强化鱼/海星/水草/溺尸出现权重与可见度。  
- 复核海洋地面与装饰生成，确保无树木语义残留。

3. 火山贴地与地貌一致性  
涉及：`apk/src/modules/21-decorations-new.js`、`apk/src/modules/11-game-init.js`  
动作：统一火山装饰物锚点（groundY/topY 语义统一），避免“悬浮/埋地”。

4. 单词挑战可读性与多空显示  
涉及：`apk/src/styles.css`、`apk/src/modules/12-challenges.js`  
动作：  
- `challenge-fill-word` 引入响应式缩放、自动换行/断词、字距按词长衰减。  
- 多空补全显示按原词位置信息插空，保证两个空之间视觉间距合理。

验收：

- 低分首轮樱花群系不再“秒掉血”；高分重入后有明显挑战提升。
- 蘑菇群系不会“刚进就切走”。
- 海洋无爆炸惩罚，且海洋元素出现完整。
- 长词/短语在挑战框内不溢出。

## P2：BOSS 体验与世界观一致化（2-3 天）

目标：凋零与其它 BOSS 机制“看起来像它该有的样子”。

工作包：

1. 凋零战重构（优先）  
涉及：`apk/src/modules/15-entities-boss.js`、`apk/src/modules/14-renderer-entities.js`  
动作：  
- 固化凋零三头轮廓与阶段演出。  
- 主攻击改为“紫色方块弹幕 + 追踪弹”的躲避压迫。  
- 阶段提示、伤害节奏、可视反馈统一。

2. 其它 BOSS 平衡化  
涉及：同上  
动作：统一“阶段门槛、压制手段、反制窗口、奖励强度”，避免机制离散。

验收：

- 进入凋零战后能明确看到凋零本体与阶段变化。
- 各 BOSS 难度有层次但不跳崖。

## P3：联调、测试、文档收敛（1-2 天）

目标：确保改动可持续迭代。

工作包：

1. 调试页回归脚本化  
涉及：`apk/tests/debug-pages/GameDebug.html`  
动作：补充“一键切群系/加分/触发BOSS/生成敌人”回归流程说明。

2. 冒烟+回归清单  
动作：覆盖树卡位、群系切换、海洋禁爆、长词挑战、凋零三阶段。

3. 文档更新  
涉及：`apk/docs/development/游戏优化-0217/`、版本计划文档  
动作：记录参数变更与验收证据。

## 4. 优先级与依赖

必须顺序：

1. 先做 P0（不稳定项和乱码）
2. 再做 P1（主体验）
3. 再做 P2（BOSS 深化）
4. 最后 P3（收敛）

原因：

- 若编码与双BOSS系统不先收敛，后续体验调参会反复失真。
- 若不先修树碰撞卡死，任何难度优化都会被“基础不可玩”掩盖。

## 5. 建议里程碑输出物

- M1（P0 完成）：可玩、可读、单 BOSS 链路稳定。
- M2（P1 完成）：群系节奏+海洋生态+挑战UI 达标。
- M3（P2 完成）：凋零与其它 BOSS 体验统一。
- M4（P3 完成）：测试通过、文档闭环、可发版。

## 6. 风险提示

1. 代码存在历史并行实现（旧链路与新链路共存），需防止“修新坏旧”。  
2. 文案分散在 HTML 与 JS，若不先抽取会反复出现乱码/遗漏。  
3. BOSS 与群系改动耦合游戏节奏，需配合调试页做快速回归。

---

如果按这个总计划推进，建议下一步直接进入 **P0 的落地任务拆分（按文件+提交粒度）**。
