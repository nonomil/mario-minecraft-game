# Step 9: v1.5.1 - Êµ∑Ê¥ãÁîüÁâ©

## ÁâàÊú¨‰ø°ÊÅØ
- **ÁâàÊú¨Âè∑**: 1.5.1
- **versionCode**: 46
- **‰∏ªÈ¢ò**: Êñ∞Â¢ûÊµ∑Ê¥ãÁîüÁâ© - È≥ïÈ±ºÔºàÂèãÂ•ΩÔºâ+ ‰πåË¥ºÔºàÂñ∑Â¢®Ôºâ
- **ÂâçÁΩÆÁâàÊú¨**: v1.5.0

## ÁõÆÊ†á
‰∏∫Êµ∑Ê¥ãÁéØÂ¢ÉÊ∑ªÂä†‰∏§ÁßçÊñ∞ÁîüÁâ©ÔºöÈ≥ïÈ±ºÔºàÂèãÂ•ΩÔºåÂèØÂáªÊùÄÊéâËêΩÈ£üÁâ©ÔºâÂíå‰πåË¥ºÔºàË¢´ÊîªÂáªÊó∂Âñ∑Â¢®Ê±ÅÈÅÆÊå°ËßÜÈáéÔºâ„ÄÇ

## ‰øÆÊîπÊ∏ÖÂçï

### 1. ‰øÆÊîπ `src/modules/15-entities-particles.js` - Êñ∞Â¢ûÊµ∑Ê¥ãÁîüÁâ©

**È≥ïÈ±ºÔºàÂèãÂ•ΩÁîüÁâ©Ôºâ**:

```javascript
// Âú® ENEMY_TYPES ÊàñÂçïÁã¨ÁöÑÁîüÁâ©Á≥ªÁªü‰∏≠Ê∑ªÂä†
const OCEAN_CREATURES = {
    cod: {
        name: 'È≥ïÈ±º',
        hp: 1,
        damage: 0,           // ‰∏çÊîªÂáª
        speed: 1.5,
        width: 24,
        height: 12,
        color: '#A9A9A9',    // ÁÅ∞Ëâ≤
        hostile: false,
        drops: [{ type: 'raw_fish', chance: 1.0 }],
        behavior: 'swim_random', // ÈöèÊú∫Ê∏∏Âä®
        fleeOnSight: true,       // ÁúãÂà∞Áé©ÂÆ∂ÈÄÉË∑ë
        fleeDistance: 80,
        swimPattern: 'figure8'   // 8Â≠óÂΩ¢Ê∏∏Âä®
    }
};
```

**È≥ïÈ±ºAI**:

```javascript
class CodFish {
    constructor(x, y) {
        this.x = x;
        this.y = y;
        this.hp = 1;
        this.width = 24;
        this.height = 12;
        this.speed = 1.5;
        this.facing = Math.random() > 0.5 ? 1 : -1;
        this.swimAngle = Math.random() * Math.PI * 2;
        this.alive = true;
        this.fleeing = false;
    }

    update(dt) {
        if (!this.alive) return;
        const distToPlayer = Math.hypot(player.x - this.x, player.y - this.y);

        if (distToPlayer < 80) {
            // ÈÄÉË∑ë
            this.fleeing = true;
            const angle = Math.atan2(this.y - player.y, this.x - player.x);
            this.x += Math.cos(angle) * this.speed * 2;
            this.y += Math.sin(angle) * this.speed * 2;
        } else {
            this.fleeing = false;
            // 8Â≠óÂΩ¢Ê∏∏Âä®
            this.swimAngle += 0.03;
            this.x += Math.sin(this.swimAngle) * this.speed * 0.5;
            this.y += Math.cos(this.swimAngle * 2) * this.speed * 0.3;
        }

        // ËæπÁïåÈôêÂà∂
        this.x = Math.max(10, Math.min(this.x, canvas.width - 10));
        this.y = Math.max(30, Math.min(this.y, canvas.height - 60));
    }

    takeDamage() {
        this.alive = false;
        // ÊéâËêΩÁîüÈ±º
        inventory['raw_fish'] = (inventory['raw_fish'] || 0) + 1;
        showFloatingText('+1 üêü', this.x, this.y - 10, '#87CEEB');
    }

    render(ctx) {
        if (!this.alive) return;
        // ÁÅ∞Ëâ≤Â∞èÈ±º
        ctx.fillStyle = '#A9A9A9';
        ctx.fillRect(this.x, this.y, this.width, this.height);
        // Â∞æÂ∑¥
        ctx.fillStyle = '#808080';
        const tailX = this.facing > 0 ? this.x - 6 : this.x + this.width;
        ctx.fillRect(tailX, this.y + 2, 6, 8);
        // ÁúºÁùõ
        ctx.fillStyle = '#000';
        const eyeX = this.facing > 0 ? this.x + this.width - 6 : this.x + 2;
        ctx.fillRect(eyeX, this.y + 3, 3, 3);
    }
}
```

### 2. ‰πåË¥ºÔºàÊïåÂØπÁîüÁâ© + Âñ∑Â¢®Êú∫Âà∂Ôºâ

```javascript
class Squid {
    constructor(x, y) {
        this.x = x;
        this.y = y;
        this.hp = 3;
        this.maxHp = 3;
        this.width = 28;
        this.height = 32;
        this.speed = 1.0;
        this.alive = true;
        this.hostile = false;    // ÈªòËÆ§‰∏ç‰∏ªÂä®ÊîªÂáª
        this.inkCooldown = 0;
        this.swimAngle = Math.random() * Math.PI * 2;
    }

    update(dt) {
        if (!this.alive) return;
        // ÁºìÊÖ¢Ê∏∏Âä®
        this.swimAngle += 0.02;
        this.x += Math.sin(this.swimAngle) * this.speed * 0.3;
        this.y += Math.cos(this.swimAngle * 0.7) * this.speed * 0.2;

        if (this.inkCooldown > 0) this.inkCooldown--;
    }

    takeDamage(amount) {
        this.hp -= amount;
        // Ë¢´ÊîªÂáªÊó∂Âñ∑Â¢®Ê±ÅÔºÅ
        if (this.inkCooldown <= 0) {
            this.sprayInk();
            this.inkCooldown = 300; // 5ÁßíÂÜ∑Âç¥
        }
        if (this.hp <= 0) {
            this.alive = false;
            showFloatingText('+10 ü™ô', this.x, this.y - 10, '#FFD700');
        }
    }

    sprayInk() {
        // ÂÖ®Â±èÂ¢®Ê±ÅÊïàÊûú
        gameState.inkEffect = {
            active: true,
            timer: 120, // 2Áßí
            opacity: 0.9
        };
        showFloatingText('ü¶ë Ë¢´Â¢®Ê±ÅÂñ∑‰∏≠!', canvas.width/2, canvas.height/2, '#333');
    }

    render(ctx) {
        if (!this.alive) return;
        // Ê∑±ËìùËâ≤Ë∫´‰Ωì
        ctx.fillStyle = '#191970';
        ctx.fillRect(this.x, this.y, this.width, this.height - 8);
        // Ëß¶Êâã
        ctx.fillStyle = '#1A1A6E';
        for (let i = 0; i < 4; i++) {
            const tx = this.x + 2 + i * 7;
            const sway = Math.sin(Date.now()/400 + i) * 2;
            ctx.fillRect(tx + sway, this.y + this.height - 8, 4, 10);
        }
        // ÁúºÁùõ
        ctx.fillStyle = '#FF4444';
        ctx.fillRect(this.x + 6, this.y + 8, 5, 5);
        ctx.fillRect(this.x + 17, this.y + 8, 5, 5);
    }
}
```

### 3. Â¢®Ê±ÅÊïàÊûúÊ∏≤Êüì

**Âú®‰∏ªÊ∏≤ÊüìÂæ™ÁéØ‰∏≠Ê∑ªÂä†Â¢®Ê±ÅÈÅÆÁΩ©**:

```javascript
function renderInkEffect(ctx) {
    if (!gameState.inkEffect || !gameState.inkEffect.active) return;

    const ink = gameState.inkEffect;
    ink.timer--;

    // Ê∏êÂèòÊ∂àÊï£
    const progress = ink.timer / 120;
    ctx.fillStyle = `rgba(0, 0, 0, ${ink.opacity * progress})`;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // ‰∏≠Èó¥ÊñáÂ≠ó
    if (ink.timer > 60) {
        ctx.fillStyle = '#FFF';
        ctx.font = 'bold 20px Arial';
        ctx.textAlign = 'center';
        ctx.fillText('Â∑≤Ë¢´Â¢®Ê±ÅÂñ∑‰∏≠!', canvas.width/2, canvas.height/2);
    }

    if (ink.timer <= 0) {
        ink.active = false;
    }
}
```

### 4. Êµ∑Ê¥ãÁîüÁâ©ÁîüÊàê

**Âú®Êµ∑Ê¥ãÁéØÂ¢É‰∏≠Ëá™Âä®ÁîüÊàêÈ≥ïÈ±ºÂíå‰πåË¥º**:

```javascript
function spawnOceanCreatures() {
    if (currentBiome !== 'ocean') return;

    // ÊØèÂÖ≥ÁîüÊàê3-5Êù°È≥ïÈ±º
    const codCount = 3 + Math.floor(Math.random() * 3);
    for (let i = 0; i < codCount; i++) {
        oceanCreatures.push(new CodFish(
            Math.random() * canvas.width,
            100 + Math.random() * (canvas.height - 200)
        ));
    }

    // ÊØèÂÖ≥ÁîüÊàê1-2Âè™‰πåË¥º
    const squidCount = 1 + Math.floor(Math.random() * 2);
    for (let i = 0; i < squidCount; i++) {
        oceanCreatures.push(new Squid(
            Math.random() * canvas.width,
            80 + Math.random() * (canvas.height - 180)
        ));
    }
}
```

### 5. Êñ∞Â¢ûÁîüÈ±ºÈ£üÁâ©

**Âú® `01-config.js` ÁöÑ FOOD_TYPES ‰∏≠Ê∑ªÂä†**:

```javascript
raw_fish: { heal: 1, icon: 'üêü', name: 'ÁîüÈ±º', color: '#87CEEB' }
```

## ÊµãËØïË¶ÅÁÇπ

1. ËøõÂÖ•Êµ∑Ê¥ãÁéØÂ¢É ‚Üí Ëá™Âä®ÁîüÊàêÈ≥ïÈ±ºÂíå‰πåË¥º
2. È≥ïÈ±ºÂÅö8Â≠óÂΩ¢Ê∏∏Âä®
3. Èù†ËøëÈ≥ïÈ±º ‚Üí È≥ïÈ±ºÈÄÉË∑ë
4. ÊîªÂáªÈ≥ïÈ±º ‚Üí ‰∏ÄÂáªÂáªÊùÄÔºåÊéâËêΩÁîüÈ±º
5. ÁîüÈ±ºÂèØÂú®ËÉåÂåÖ‰∏≠‰ΩøÁî®ÂõûË°Ä
6. ‰πåË¥ºÁºìÊÖ¢Ê∏∏Âä®Ôºå‰∏ç‰∏ªÂä®ÊîªÂáª
7. ÊîªÂáª‰πåË¥º ‚Üí Â±èÂπïÂèòÈªë2ÁßíÔºàÂ¢®Ê±ÅÊïàÊûúÔºâ
8. Â¢®Ê±ÅÊïàÊûúÊ∏êÂèòÊ∂àÊï£
9. ‰πåË¥º3Ê¨°ÊîªÂáªÂêéÊ≠ª‰∫°
10. Á¶ªÂºÄÊµ∑Ê¥ãÁéØÂ¢É ‚Üí Êµ∑Ê¥ãÁîüÁâ©Ê∏ÖÈô§

## Êèê‰∫§‰ø°ÊÅØ

```
feat: Êµ∑Ê¥ãÁîüÁâ© - È≥ïÈ±º‰∏é‰πåË¥º (v1.5.1)

- Êñ∞Â¢ûÈ≥ïÈ±ºÔºàÂèãÂ•ΩÔºå8Â≠óÂΩ¢Ê∏∏Âä®ÔºåÂáªÊùÄÊéâËêΩÁîüÈ±ºÔºâ
- Êñ∞Â¢û‰πåË¥ºÔºàË¢´ÊîªÂáªÂñ∑Â¢®Ê±ÅÔºåÂ±èÂπïÂèòÈªë2ÁßíÔºâ
- Êñ∞Â¢ûÁîüÈ±ºÈ£üÁâ©ÔºàÂõû1ÂøÉÔºâ
- Êµ∑Ê¥ãÁéØÂ¢ÉËá™Âä®ÁîüÊàêÊµ∑Ê¥ãÁîüÁâ©
```
