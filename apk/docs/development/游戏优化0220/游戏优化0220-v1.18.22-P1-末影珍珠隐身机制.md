# v1.18.22 (P1) - 末影珍珠隐身机制

## 1. 版本目标

- 使用末影珍珠后触发 60 秒隐身状态。
- 隐身期间敌人无法锁定玩家（或玩家免疫伤害，二选一，推荐先做“无法锁定”）。

## 2. 计划修改文件

- `apk/src/modules/13-game-loop.js`（末影珍珠使用与状态）
- `apk/src/modules/20-enemies-new.js`（敌人 AI 目标选择）
- `apk/src/modules/15-entities-particles.js`（老敌人逻辑兼容）
- `apk/src/modules/01-config.js`（隐身时长与策略配置）

## 3. 实现策略

- 新增状态：`playerStatus.invisibleUntilMs`
- 触发时机：`ender_pearl` 成功消耗后
- 规则建议：
: 隐身期间敌人不发起新攻击；已飞行中的弹道不追踪（可继续存在）

## 4. Step by Step

1. 状态与 UI
- 末影珍珠使用后写入 `invisibleUntilMs = now + 60000`
- HUD 显示剩余秒数（低频刷新）。

2. AI 目标过滤
- 在敌人 update 行为入口加 `isPlayerInvisible()` 判断。
- 隐身时进入巡逻/待机，不追击。

3. 伤害策略
- 方案 A（推荐）：不免疫，仅“不会被瞄准”，已有弹幕可命中。
- 方案 B（可选）：完全免伤，需额外平衡冷却与成本。

## 5. 验收标准

- 使用末影珍珠后，敌人明显失去追击能力 60 秒。
- 隐身结束后敌人恢复正常追击。
- 不影响其他道具冷却与热键流程。

## 6. 风险与回滚

- 风险：隐身与无敌帧叠加造成过强。
- 防护：保持“隐身不等于无敌”，先用方案 A 上线。
