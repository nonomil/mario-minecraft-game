# v1.8.4 存档石碑与特色建筑（实施状态）

更新时间：2026-02-16  
状态：已实现

---

## 已实现内容

1. 存档石碑交互  
- 可在村庄 `save_stone` 建筑触发存档。
- 同一村庄重复交互会提示“已存档”。
- 同步写入：
  - 常规账号进度（`saveCurrentProgress()`）
  - 村庄检查点（`localStorage['mmwg:villageCheckpoint']`）

2. 六种特色建筑交互  
- 已支持并可执行一次性效果：
  - `library`
  - `hot_spring`
  - `water_station`
  - `blacksmith`
  - `lighthouse`
  - `brewing_stand`

3. 建筑一次性使用限制  
- 每个村庄特色建筑仅可触发一次（`village.specialUsed`）。

4. 存档石碑视觉反馈  
- 已存档状态会显示发光与描边提示。

---

## 代码位置

- `apk/src/modules/18-village.js`
  - `handleVillageInteraction()`
  - `saveVillageProgress()`
  - `SPECIAL_BUILDING_EFFECTS`
  - `interactSpecialBuilding()`
- `apk/src/modules/18-village-render.js`
  - `drawVillageBuilding()`（save_stone 已存档高亮）
- `apk/src/modules/06-biome.js`
  - 地狱入场扣血与高温掉血接入 `fireResistance` buff 判断
