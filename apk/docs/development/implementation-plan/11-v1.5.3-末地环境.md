# Step 11: v1.5.3 - æœ«åœ°ç¯å¢ƒï¼ˆå¯é€‰ï¼‰

## ç‰ˆæœ¬ä¿¡æ¯
- **ç‰ˆæœ¬å·**: 1.5.3
- **versionCode**: 48
- **ä¸»é¢˜**: æ–°å¢æœ«åœ°(End)ç”Ÿç‰©ç¾¤ç³» - ä½é‡åŠ› + ä¼ é€é—¨ + æ–°æ•Œäºº
- **å‰ç½®ç‰ˆæœ¬**: v1.5.2
- **ä¼˜å…ˆçº§**: ä½ï¼ˆå¯é€‰å®ç°ï¼‰

## ç›®æ ‡
æ–°å¢ç¬¬9ä¸ªç”Ÿç‰©ç¾¤ç³»"æœ«åœ°"ï¼Œç‰¹è‰²æ˜¯ä½é‡åŠ›è·³è·ƒã€ä¼ é€é—¨æœºåˆ¶ã€æœ«å½±è¨å’Œæ½œå½±è´æ•Œäººã€‚

## ä¿®æ”¹æ¸…å•

### 1. ä¿®æ”¹ `config/biomes.json` - æ–°å¢æœ«åœ°ç”Ÿç‰©ç¾¤ç³»

```json
{
    "id": "end",
    "name": "æœ«åœ°",
    "nameEn": "The End",
    "backgroundColor": "#1A0A2E",
    "groundColor": "#E8E8B0",
    "platformColor": "#2D1B4E",
    "unlockScore": 2000,
    "speedMultiplier": 1.0,
    "gravityMultiplier": 0.65,
    "jumpMultiplier": 1.5,
    "weather": "none",
    "particles": "end_particles",
    "decorations": ["end_stone_pillar", "obsidian_platform", "chorus_plant", "purple_crystal"],
    "enemies": ["endermite", "shulker"],
    "specialEffects": ["low_gravity", "teleport_portal"]
}
```

### 2. ä½é‡åŠ›æ•ˆæœ

```javascript
// åœ¨ç©å®¶ç‰©ç†æ›´æ–°ä¸­
function applyBiomePhysics() {
    if (currentBiome === 'end') {
        // ä½é‡åŠ›
        player.gravity = DEFAULT_GRAVITY * 0.65;
        // è·³è·ƒé«˜åº¦x1.5
        player.jumpForce = DEFAULT_JUMP_FORCE * 1.5;
        // ä¸‹è½é€Ÿåº¦å‡æ…¢
        player.maxFallSpeed = DEFAULT_MAX_FALL * 0.7;
    } else {
        player.gravity = DEFAULT_GRAVITY;
        player.jumpForce = DEFAULT_JUMP_FORCE;
        player.maxFallSpeed = DEFAULT_MAX_FALL;
    }
}
```

### 3. ä¼ é€é—¨æœºåˆ¶

```javascript
class EndPortal {
    constructor(x, y) {
        this.x = x;
        this.y = y;
        this.width = 24;
        this.height = 32;
        this.cooldown = 0;
        this.rotationAngle = 0;
    }

    update(dt) {
        this.rotationAngle += 0.05;
        if (this.cooldown > 0) this.cooldown--;

        // ç©å®¶è§¦ç¢°ä¼ é€
        if (this.cooldown <= 0 && isOverlapping(player, this)) {
            this.teleportPlayer();
            this.cooldown = 180; // 3ç§’å†·å´
        }
    }

    teleportPlayer() {
        // ä¼ é€åˆ°éšæœºå®‰å…¨ä½ç½®
        const safePositions = platforms.filter(p => p.y < canvas.height - 60);
        if (safePositions.length > 0) {
            const target = safePositions[Math.floor(Math.random() * safePositions.length)];
            player.x = target.x + target.width/2;
            player.y = target.y - player.height;
            // ä¼ é€ç‰¹æ•ˆ
            spawnTeleportParticles(player.x, player.y);
            showFloatingText('âœ¨ ä¼ é€!', player.x, player.y - 20, '#9B59B6');
            playSound('teleport');
        }
    }

    render(ctx) {
        // ç´«è‰²æ—‹æ¶¡
        ctx.save();
        ctx.translate(this.x + this.width/2, this.y + this.height/2);
        ctx.rotate(this.rotationAngle);

        ctx.fillStyle = '#9B59B6';
        ctx.fillRect(-this.width/2, -this.height/2, this.width, this.height);

        // å†…éƒ¨æ—‹æ¶¡çº¿
        ctx.strokeStyle = '#E8D5F5';
        ctx.lineWidth = 2;
        for (let i = 0; i < 3; i++) {
            const r = 6 + i * 4;
            ctx.beginPath();
            ctx.arc(0, 0, r, 0, Math.PI * 1.5);
            ctx.stroke();
        }

        ctx.restore();

        // å†·å´æŒ‡ç¤º
        if (this.cooldown > 0) {
            ctx.globalAlpha = 0.5;
            ctx.fillStyle = '#333';
            ctx.fillRect(this.x, this.y, this.width, this.height);
            ctx.globalAlpha = 1;
        }
    }
}
```

### 4. æœ«å½±è¨ï¼ˆé£è¡Œè¿½å‡»æ•Œäººï¼‰

```javascript
// åœ¨ ENEMY_TYPES ä¸­æ·»åŠ 
endermite: {
    name: 'æœ«å½±è¨',
    hp: 3,
    damage: 0.5,
    speed: 2.5,
    width: 16,
    height: 12,
    color: '#1A1A2E',
    attackType: 'fly_chase',  // é£è¡Œè¿½å‡»
    drops: [{ type: 'ender_pearl', chance: 0.1 }]
}

// æœ«å½±è¨AI
class Endermite {
    constructor(x, y) {
        this.x = x; this.y = y;
        this.hp = 3; this.maxHp = 3;
        this.width = 16; this.height = 12;
        this.speed = 2.5;
        this.alive = true;
    }

    update(dt) {
        // é£è¡Œè¿½å‡»ç©å®¶
        const dx = player.x - this.x;
        const dy = player.y - this.y;
        const dist = Math.hypot(dx, dy);
        if (dist > 0) {
            this.x += (dx / dist) * this.speed;
            this.y += (dy / dist) * this.speed;
        }
    }

    render(ctx) {
        ctx.fillStyle = '#1A1A2E';
        ctx.fillRect(this.x, this.y, this.width, this.height);
        // ç´«è‰²çœ¼ç›
        ctx.fillStyle = '#9B59B6';
        ctx.fillRect(this.x + 3, this.y + 3, 3, 3);
        ctx.fillRect(this.x + 10, this.y + 3, 3, 3);
    }
}
```

### 5. æ½œå½±è´ï¼ˆå›ºå®šç‚®å°ï¼‰

```javascript
class Shulker {
    constructor(x, y) {
        this.x = x; this.y = y;
        this.width = 24; this.height = 24;
        this.hp = 5; this.maxHp = 5;
        this.alive = true;
        this.open = false;       // è´å£³å¼€åˆ
        this.openTimer = 0;
        this.attackTimer = 0;
        this.projectiles = [];
    }

    update(dt) {
        // å‘¨æœŸæ€§å¼€åˆ
        this.openTimer++;
        this.open = (this.openTimer % 240) < 120; // 2ç§’å¼€2ç§’åˆ

        // å¼€å¯æ—¶å‘å°„è¿½è¸ªå¼¹
        if (this.open) {
            this.attackTimer++;
            if (this.attackTimer >= 120) { // æ¯2ç§’
                this.shootTracker();
                this.attackTimer = 0;
            }
        }

        // æ›´æ–°è¿½è¸ªå¼¹
        this.projectiles.forEach(p => {
            // ç¼“æ…¢è¿½è¸ªç©å®¶
            const dx = player.x - p.x;
            const dy = player.y - p.y;
            const dist = Math.hypot(dx, dy);
            if (dist > 0) {
                p.vx += (dx / dist) * 0.1;
                p.vy += (dy / dist) * 0.1;
                // é™é€Ÿ
                const speed = Math.hypot(p.vx, p.vy);
                if (speed > 2) {
                    p.vx = (p.vx / speed) * 2;
                    p.vy = (p.vy / speed) * 2;
                }
            }
            p.x += p.vx;
            p.y += p.vy;
            p.life--;
        });
        this.projectiles = this.projectiles.filter(p => p.life > 0);
    }

    shootTracker() {
        this.projectiles.push({
            x: this.x + this.width/2,
            y: this.y,
            vx: 0, vy: -1,
            damage: 1,
            size: 8,
            life: 300 // 5ç§’
        });
    }

    takeDamage(amount) {
        if (!this.open) return; // å…³é—­æ—¶æ— æ•Œ
        this.hp -= amount;
        if (this.hp <= 0) this.alive = false;
    }

    render(ctx) {
        if (!this.alive) return;
        // è´å£³
        ctx.fillStyle = '#6A0DAD';
        if (this.open) {
            // å¼€å¯çŠ¶æ€ - ä¸Šä¸‹åˆ†å¼€
            ctx.fillRect(this.x, this.y - 4, this.width, this.height/2);
            ctx.fillRect(this.x, this.y + this.height/2 + 4, this.width, this.height/2);
            // å†…éƒ¨ï¼ˆé»„è‰²çœ¼ç›ï¼‰
            ctx.fillStyle = '#FFD700';
            ctx.fillRect(this.x + 8, this.y + 8, 8, 8);
        } else {
            // å…³é—­çŠ¶æ€
            ctx.fillRect(this.x, this.y, this.width, this.height);
        }

        // è¿½è¸ªå¼¹
        this.projectiles.forEach(p => {
            ctx.fillStyle = '#E8D5F5';
            ctx.fillRect(p.x - p.size/2, p.y - p.size/2, p.size, p.size);
            // æ‹–å°¾
            ctx.globalAlpha = 0.3;
            ctx.fillRect(p.x - p.vx*2 - p.size/2, p.y - p.vy*2 - p.size/2, p.size, p.size);
            ctx.globalAlpha = 1;
        });
    }
}
```

### 6. æœ«åœ°ç¯å¢ƒæ¸²æŸ“

```javascript
function renderEndEnvironment(ctx) {
    // æ·±ç´«é»‘è‰²è™šç©ºèƒŒæ™¯
    ctx.fillStyle = '#1A0A2E';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // ç´«è‰²ç²’å­é£˜æµ®
    if (frameCount % 5 === 0) {
        endParticles.push({
            x: Math.random() * canvas.width,
            y: canvas.height + 5,
            vy: -0.5 - Math.random(),
            vx: (Math.random() - 0.5) * 0.5,
            size: 1 + Math.random() * 2,
            life: 1.0
        });
    }

    endParticles.forEach(p => {
        p.x += p.vx; p.y += p.vy;
        p.life -= 0.005;
        ctx.globalAlpha = p.life * 0.5;
        ctx.fillStyle = '#9B59B6';
        ctx.fillRect(p.x, p.y, p.size, p.size);
    });
    ctx.globalAlpha = 1;
    endParticles = endParticles.filter(p => p.life > 0);

    // æœ«åœ°çŸ³æŸ±ï¼ˆç±³ç™½è‰²ï¼‰
    // é»‘æ›œçŸ³å¹³å°ï¼ˆå®‰å…¨åŒºï¼‰
    // ç´«è‰²æ°´æ™¶ï¼ˆåŠ é€Ÿbuffï¼‰
}

// ç´«è‰²æ°´æ™¶ - è§¦ç¢°è·å¾—5ç§’åŠ é€Ÿ
class PurpleCrystal {
    constructor(x, y) {
        this.x = x; this.y = y;
        this.width = 16; this.height = 20;
        this.collected = false;
    }

    update() {
        if (this.collected) return;
        if (isOverlapping(player, this)) {
            this.collected = true;
            player.speedBuff = 300; // 5ç§’
            player.speedMultiplier = 1.5;
            showFloatingText('ğŸ’ åŠ é€Ÿ!', this.x, this.y - 10, '#9B59B6');
        }
    }

    render(ctx) {
        if (this.collected) return;
        // å‘å…‰ç´«æ°´æ™¶
        ctx.fillStyle = '#9B59B6';
        // è±å½¢
        ctx.beginPath();
        ctx.moveTo(this.x + this.width/2, this.y);
        ctx.lineTo(this.x + this.width, this.y + this.height/2);
        ctx.lineTo(this.x + this.width/2, this.y + this.height);
        ctx.lineTo(this.x, this.y + this.height/2);
        ctx.fill();
        // å‘å…‰
        ctx.globalAlpha = 0.3 + Math.sin(Date.now()/300) * 0.2;
        ctx.fillStyle = '#E8D5F5';
        ctx.fill();
        ctx.globalAlpha = 1;
    }
}
```

## æµ‹è¯•è¦ç‚¹

1. åˆ†æ•°è¾¾åˆ°2000+ â†’ å¯èƒ½åˆ‡æ¢åˆ°æœ«åœ°ç¯å¢ƒ
2. ä½é‡åŠ›ï¼šè·³è·ƒæ›´é«˜ï¼Œä¸‹è½æ›´æ…¢
3. ç´«è‰²ä¼ é€é—¨ â†’ è§¦ç¢°ä¼ é€åˆ°éšæœºä½ç½®ï¼Œ3ç§’å†·å´
4. æœ«å½±è¨é£è¡Œè¿½å‡»ç©å®¶
5. æ½œå½±è´å›ºå®šåœ¨å¢™ä¸Šï¼Œå¼€åˆå‘¨æœŸï¼Œå‘å°„è¿½è¸ªå¼¹
6. æ½œå½±è´å…³é—­æ—¶æ— æ•Œ
7. ç´«è‰²æ°´æ™¶ â†’ è§¦ç¢°è·å¾—5ç§’åŠ é€Ÿ
8. æ·±ç´«è‰²èƒŒæ™¯ + ç´«è‰²ç²’å­é£˜æµ®
9. ç¦»å¼€æœ«åœ° â†’ æ¢å¤æ­£å¸¸é‡åŠ›

## æäº¤ä¿¡æ¯

```
feat: æœ«åœ°ç¯å¢ƒ - ä½é‡åŠ›ä¸ä¼ é€é—¨ (v1.5.3)

- æ–°å¢æœ«åœ°ç”Ÿç‰©ç¾¤ç³»ï¼ˆç¬¬9ä¸ªï¼‰
- ä½é‡åŠ›æ•ˆæœï¼šè·³è·ƒx1.5ï¼Œä¸‹è½å‡æ…¢
- ç´«è‰²ä¼ é€é—¨ï¼šéšæœºä¼ é€ï¼Œ3ç§’å†·å´
- æœ«å½±è¨ï¼šé£è¡Œè¿½å‡»æ•Œäºº
- æ½œå½±è´ï¼šå›ºå®šç‚®å°ï¼Œè¿½è¸ªå¼¹ï¼Œå¼€åˆæ— æ•Œ
- ç´«è‰²æ°´æ™¶ï¼š5ç§’åŠ é€Ÿbuff
- æ·±ç´«è‰²è™šç©ºèƒŒæ™¯ + ç²’å­æ•ˆæœ
```
