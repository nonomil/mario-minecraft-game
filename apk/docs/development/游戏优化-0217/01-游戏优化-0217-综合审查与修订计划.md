# 游戏优化-0217 综合审查与修订计划

日期：2026-02-17  
依据文档：  
- `apk/docs/development/游戏优化-0217/00-游戏优化-0217-整体Plan-综述.md`  
- `apk/docs/development/游戏优化-0217/游戏优化-综合计划.md`

---

## 一、审查结论（先结论）

两份文档方向一致，但 `游戏优化-综合计划.md` 存在若干“实现路径偏差”和“可执行性缺口”，建议以本修订版作为执行基线。

### 高优先级审查发现

1. BOSS 路线未消除“双系统并行”风险  
现状代码同时存在旧 `ender_dragon` 触发链与 `bossArena`：`apk/src/modules/13-game-loop.js`、`apk/src/modules/15-entities-boss.js`、`apk/src/modules/14-renderer-main.js`。  
如不先单轨化，后续 BOSS 优化会持续出现“提示与实体不一致”。

2. 中文乱码根因定位不完整  
乱码不只在 toast 逻辑，`apk/Game.html` 已有大量静态乱码文本。  
仅在 `10-ui.js/06-biome.js` 修提示不足以闭环，必须纳入 HTML 文案治理与编码检查。

3. 海洋问题的实现入口描述偏差  
海洋敌人与群系敌池核心逻辑在 `apk/src/modules/11-game-init.js`、`apk/src/modules/20-enemies-new.js`、`apk/src/modules/15-entities-combat.js`，不是仅 `15-entities-particles.js`。

4. 火山“悬浮”问题应优先查装饰锚点  
火山新装饰在 `apk/src/modules/21-decorations-new.js`，应先核对 `groundY`/`y` 锚点语义与生成入口，而非先改平台系统。

### 中优先级审查发现

1. 单词测验“整体缩小 50%”风险较高  
直接减半会影响短词可读性，应改为“按长度自适应缩放 + 换行断词 + 字距衰减”。

2. 群系“最短停留”应双阈值  
仅按分数或仅按时间都可能失真，建议“最少分数 + 最短停留时间”组合门槛。

3. 难度分层需兼容现有全局难度  
建议“群系分层决定敌人种类/机制，全局难度决定数值倍率”，避免双重放大。

---

## 二、修订后的统一目标

在不破坏 `apk/` 当前可运行主线的前提下，完成：

1. 可读：彻底清理中文乱码。
2. 可玩：修复树碰撞卡死、BOSS 进入错位。
3. 合理：群系节奏与难度分层可解释且可调参。
4. 一致：海洋/火山/BOSS 表现符合“我的世界”语义。
5. 可验：每一阶段均有明确回归入口与验收标准。

---

## 三、修订执行计划（P0-P3）

## P0 稳定性止血（必须先做，1-2天）

### P0-1 乱码治理闭环

- 范围：`apk/Game.html`、`apk/src/modules/*`、构建链相关脚本
- 动作：
  1. 统一 UTF-8（无 BOM）  
  2. 清理 `apk/Game.html` 静态乱码文案  
  3. 将核心提示文案集中到统一常量区，减少散落字面量

### P0-2 BOSS 单轨化

- 范围：`apk/src/modules/13-game-loop.js`、`apk/src/modules/15-entities-boss.js`、`apk/src/modules/14-renderer-main.js`
- 动作：
  1. 下线旧 `ender_dragon` 自动触发链  
  2. 仅保留 `bossArena` 进入/更新/渲染链  
  3. 统一提示条、血条、阶段文案来源

### P0-3 树碰撞脱困修复

- 范围：`apk/src/modules/13-game-loop.js`
- 动作：
  1. 树干碰撞加入“方向判定 + 推离修正”  
  2. 加入最小脱困容差，避免左右输入都被清零

### P0 验收

- 无乱码主流程可见文本。
- 不再出现“进入 BOSS 但场景/实体错位”。
- 复现树卡死路径可稳定脱困。

---

## P1 主体验优化（2-4天）

### P1-1 群系节奏与分层难度

- 范围：`apk/config/biomes.json`、`apk/src/modules/06-biome.js`、`apk/src/modules/11-game-init.js`、`apk/src/modules/20-enemies-new.js`
- 动作：
  1. 增加群系轮次访问计数（visit count）  
  2. 为关键群系（樱花、蘑菇、海洋、火山）配置敌人分层表  
  3. 增加群系最短停留“双阈值”：`minStayScore + minStayTimeSec`

### P1-2 海洋生态一致性

- 范围：`apk/src/modules/11-game-init.js`、`apk/src/modules/15-entities-combat.js`、`apk/src/modules/06-biome.js`、`apk/src/modules/21-decorations-new.js`
- 动作：
  1. 海洋禁用苦力怕爆炸伤害  
  2. 提升水草/海星/鱼/溺尸可见度与出现概率  
  3. 复核海洋树木生成路径，确保无“树语义残留”

### P1-3 火山贴地修正

- 范围：`apk/src/modules/21-decorations-new.js`、`apk/src/modules/11-game-init.js`
- 动作：
  1. 统一火山装饰 `groundY` 锚点  
  2. 校正黑曜石柱/热泉/裂缝上下偏移

### P1-4 单词挑战 UI 修正

- 范围：`apk/src/styles.css`、`apk/src/modules/12-challenges.js`
- 动作：
  1. 词面自适应字号（按长度分档）  
  2. `overflow-wrap/word-break` 与多行布局  
  3. 多空补全按原词位置插空显示

### P1 验收

- 首轮樱花显著降低压制感；后续轮次有阶梯上升。
- 蘑菇群系不再“刚进入就切换”。
- 海洋无爆炸惩罚，生态元素齐全。
- 长词/短语不溢出，双空补全可读。

---

## P2 BOSS 世界观一致化（2-3天）

### P2-1 凋零优先重构

- 范围：`apk/src/modules/15-entities-boss.js`、`apk/src/modules/14-renderer-entities.js`
- 动作：
  1. 凋零三头轮廓与阶段演出重绘  
  2. 主攻击改为“紫色方块弹幕 + 追踪弹”  
  3. 阶段切换反馈统一（提示、粒子、节奏）

### P2-2 其它 BOSS 同步收敛

- 范围：同上
- 动作：
  1. 统一阶段门槛与反制窗口  
  2. 保持视觉语义接近 Minecraft，不做抽象“几何块感”

### P2 验收

- 凋零本体可识别，阶段行为可感知。
- 其它 BOSS 与凋零在表现与节奏上风格一致。

---

## P3 联调收尾（1-2天）

- 调试页验证流程固化：`apk/tests/debug-pages/GameDebug.html`
- 冒烟清单：树卡位、群系切换、海洋禁爆、长词挑战、凋零三阶段
- 文档回填：参数变更、问题关闭清单、回归证据

---

## 四、对原两份文档的补充更改建议

1. `00-游戏优化-0217-整体Plan-综述.md`  
补充“执行清单粒度”（每阶段拆成任务卡与验收脚本），可直接用于迭代管理。

2. `游戏优化-综合计划.md`  
建议修订点：
- 将 BOSS 章节前置“单轨化”前提。  
- 将乱码章节纳入 `apk/Game.html` 静态文案治理。  
- 将海洋章节核心文件修订为 `11-game-init.js + 20-enemies-new.js + 15-entities-combat.js`。  
- 将“字体减半”改为“自适应缩放策略”。

---

## 五、最终执行顺序（建议）

1. P0（稳定性）  
2. P1（主体验）  
3. P2（BOSS强化）  
4. P3（联调收尾）

该顺序可最大化避免返工。

