# v1.12.0 â€” å­¦ä¹ åé¦ˆæ ¸å¿ƒä¼˜åŒ–

> **ä¼˜å…ˆçº§**: P0
> **ç‰ˆæœ¬å·**: 1.12.0 / versionCode: 90
> **å‰ç½®ç‰ˆæœ¬**: v1.11.3ï¼ˆP2-4 å®Œæˆï¼‰
> **é¢„æœŸæ•ˆæœ**: ç­”é”™åå±•ç¤ºæ­£ç¡®ç­”æ¡ˆ+å‘éŸ³ã€è¯å¡å±•ç¤ºä¾‹å¥ã€å­¦ä¹ æ¨¡å¼ç­”é”™ä¸æ‰£åˆ†å¯é‡è¯•

---

## é—®é¢˜æè¿°

å½“å‰å­¦ä¹ ç³»ç»Ÿå­˜åœ¨ä¸‰ä¸ªæ ¸å¿ƒä½“éªŒç¼ºé™·ï¼š

1. **ç­”é”™æ— æ•™å­¦åé¦ˆ**ï¼š`12-challenges.js:299-301` ç­”é”™åªæ‰£åˆ† + æ˜¾ç¤º "âŒ æŒ‘æˆ˜å¤±è´¥"ï¼Œç©å®¶ä¸çŸ¥é“æ­£ç¡®ç­”æ¡ˆæ˜¯ä»€ä¹ˆï¼Œé”™å¤±å­¦ä¹ æœºä¼šã€‚
2. **è¯åº“å·²æœ‰ä¾‹å¥æ•°æ®æœªåˆ©ç”¨**ï¼šè¯åº“ JSON åŒ…å« `phrase`ï¼ˆå¦‚ "Smile happily"ï¼‰å’Œ `phraseTranslation`ï¼ˆå¦‚ "å¼€å¿ƒåœ°å¾®ç¬‘"ï¼‰ï¼Œä½† `normalizeRawWord()` æœªæå–ï¼Œè¯å¡ä¹Ÿæœªå±•ç¤ºã€‚
3. **å­¦ä¹ æ¨¡å¼ç­”é”™ä»æ‰£åˆ†**ï¼š`settings.learningMode` åªé™ä½æ•Œäººä¼¤å®³/æ•°é‡ï¼Œç­”é”™ä»æ‰£åˆ†ï¼Œå¯¹ä½é¾„ç”¨æˆ·ä¸å‹å¥½ã€‚

---

## ä¿®æ”¹æ¸…å•

### Step 1: ç­”é”™æ­£å‘å¼•å¯¼

#### æ–‡ä»¶: `src/modules/12-challenges.js`

**ä½ç½®**: `completeLearningChallenge()` å‡½æ•°ï¼ˆçº¦ç¬¬ 284 è¡Œï¼‰

**æ“ä½œ**: ç­”é”™åä¸ç«‹å³å…³é—­æŒ‘æˆ˜é¢æ¿ï¼Œæ”¹ä¸ºå±•ç¤ºæ­£ç¡®ç­”æ¡ˆ + æ’­æ”¾å‘éŸ³ï¼Œå»¶è¿Ÿ 2 ç§’åå…³é—­ã€‚

**å½“å‰ä»£ç **ï¼ˆç¬¬ 284-309 è¡Œï¼‰:
```javascript
function completeLearningChallenge(correct) {
    if (!currentLearningChallenge) return;
    clearLearningChallengeTimer();
    hideLearningChallenge();
    const reward = LEARNING_CONFIG.challenge.rewards;
    if (correct) {
        // ... æ­£ç¡®é€»è¾‘
    } else {
        addScore(-reward.wrong.scorePenalty);
        showFloatingText("âŒ æŒ‘æˆ˜å¤±è´¥", player.x, player.y - 40);
        if (challengeOrigin && challengeOrigin instanceof WordGate) {
            challengeOrigin.cooldown = 180;
        }
    }
    paused = challengePausedBefore;
    currentLearningChallenge = null;
    challengeOrigin = null;
}
```

**æ”¹ä¸º**:
```javascript
function completeLearningChallenge(correct) {
    if (!currentLearningChallenge) return;
    clearLearningChallengeTimer();

    const reward = LEARNING_CONFIG.challenge.rewards;
    const wordObj = currentLearningChallenge.wordObj;

    if (correct) {
        hideLearningChallenge();
        addScore(reward.correct.score);
        inventory.diamond = (inventory.diamond || 0) + (reward.correct.diamond || 0);
        updateInventoryUI();
        showFloatingText("ğŸ‰ æŒ‘æˆ˜æˆåŠŸ", player.x, player.y - 40);
        if (challengeOrigin && challengeOrigin instanceof WordGate) {
            challengeOrigin.locked = false;
            challengeOrigin.remove = true;
            showToast("ğŸ’  è¯è¯­é—¸é—¨å·²è§£é”ï¼");
        }
        paused = challengePausedBefore;
        currentLearningChallenge = null;
        challengeOrigin = null;
    } else {
        addScore(-reward.wrong.scorePenalty);
        showFloatingText("âŒ æŒ‘æˆ˜å¤±è´¥", player.x, player.y - 40);
        if (challengeOrigin && challengeOrigin instanceof WordGate) {
            challengeOrigin.cooldown = 180;
        }
        // æ–°å¢ï¼šå±•ç¤ºæ­£ç¡®ç­”æ¡ˆ
        showChallengeCorrection(wordObj);
        // å»¶è¿Ÿ 2 ç§’åå…³é—­ï¼Œè®©ç©å®¶çœ‹åˆ°æ­£ç¡®ç­”æ¡ˆ
        setTimeout(() => {
            hideLearningChallenge();
            paused = challengePausedBefore;
            currentLearningChallenge = null;
            challengeOrigin = null;
        }, 2000);
        return; // æå‰è¿”å›ï¼Œä¸ç«‹å³æ¢å¤
    }
}
```

**æ–°å¢å‡½æ•°**ï¼ˆåœ¨ `completeLearningChallenge` ä¸‹æ–¹æ·»åŠ ï¼‰:
```javascript
function showChallengeCorrection(wordObj) {
    if (!wordObj) return;
    // åœ¨æŒ‘æˆ˜é¢æ¿ä¸­è¿½åŠ æ­£ç¡®ç­”æ¡ˆå±•ç¤º
    if (challengeQuestionEl) {
        const correctionDiv = document.createElement("div");
        correctionDiv.className = "challenge-correction";
        correctionDiv.innerHTML =
            `<div style="margin-top:12px; padding:8px; background:rgba(76,175,80,0.2); border-radius:8px;">` +
            `<div style="color:#4CAF50; font-size:14px;">æ­£ç¡®ç­”æ¡ˆ:</div>` +
            `<div style="color:#FFF; font-size:18px; font-weight:bold; margin-top:4px;">` +
            `${wordObj.en} = ${wordObj.zh}</div>` +
            (wordObj.phrase ? `<div style="color:#FFD54F; font-size:12px; margin-top:4px;">${wordObj.phrase}</div>` : "") +
            `</div>`;
        challengeQuestionEl.appendChild(correctionDiv);
    }
    // ç¦ç”¨æ‰€æœ‰é€‰é¡¹æŒ‰é’®
    if (challengeOptionsEl) {
        challengeOptionsEl.querySelectorAll("button").forEach(btn => {
            btn.disabled = true;
            btn.style.opacity = "0.5";
        });
    }
    // æ’­æ”¾æ­£ç¡®å‘éŸ³
    if (typeof speakWord === "function") {
        speakWord(wordObj);
    }
}
```

**éªŒè¯**: ç­”é”™åé¢æ¿ä¸æ¶ˆå¤±ï¼Œæ˜¾ç¤ºæ­£ç¡®ç­”æ¡ˆ + å‘éŸ³ï¼Œ2 ç§’åè‡ªåŠ¨å…³é—­ã€‚

---

### Step 2: åˆ©ç”¨å·²æœ‰ phrase æ•°æ®å±•ç¤ºä¾‹å¥

#### æ–‡ä»¶ A: `src/modules/09-vocab.js`

**ä½ç½®**: `normalizeRawWord()` å‡½æ•°ï¼ˆçº¦ç¬¬ 247 è¡Œï¼‰

**å½“å‰ä»£ç **:
```javascript
function normalizeRawWord(raw) {
    if (!raw || typeof raw !== "object") return null;
    const en = String(raw.standardized || raw.word || "").trim();
    const zh = String(raw.chinese || raw.zh || raw.translation || "").trim();
    if (!en) return null;
    return {
        en,
        zh: zh || "",
        imageURLs: Array.isArray(raw.imageURLs) ? raw.imageURLs : []
    };
}
```

**æ”¹ä¸º**:
```javascript
function normalizeRawWord(raw) {
    if (!raw || typeof raw !== "object") return null;
    const en = String(raw.standardized || raw.word || "").trim();
    const zh = String(raw.chinese || raw.zh || raw.translation || "").trim();
    if (!en) return null;
    return {
        en,
        zh: zh || "",
        phrase: String(raw.phrase || "").trim() || null,
        phraseZh: String(raw.phraseTranslation || "").trim() || null,
        imageURLs: Array.isArray(raw.imageURLs) ? raw.imageURLs : []
    };
}
```

#### æ–‡ä»¶ B: `src/modules/12-challenges.js`

**ä½ç½®**: `showWordCard()` å‡½æ•°ï¼ˆçº¦ç¬¬ 20 è¡Œï¼‰

**å½“å‰ä»£ç **:
```javascript
function showWordCard(wordObj) {
    const card = document.getElementById("word-card");
    if (!card) return;
    const en = document.getElementById("word-card-en");
    const zh = document.getElementById("word-card-zh");
    if (en) en.innerText = wordObj.en;
    if (zh) zh.innerText = wordObj.zh;
    updateWordImage(wordObj);
    card.classList.add("visible");
    card.setAttribute("aria-hidden", "false");
    setTimeout(() => {
        card.classList.remove("visible");
        card.setAttribute("aria-hidden", "true");
    }, 900);
}
```

**æ”¹ä¸º**:
```javascript
function showWordCard(wordObj) {
    const card = document.getElementById("word-card");
    if (!card) return;
    const en = document.getElementById("word-card-en");
    const zh = document.getElementById("word-card-zh");
    const phraseEl = document.getElementById("word-card-phrase");
    if (en) en.innerText = wordObj.en;
    if (zh) zh.innerText = wordObj.zh;
    if (phraseEl) {
        if (wordObj.phrase) {
            phraseEl.innerText = wordObj.phrase;
            phraseEl.style.display = "block";
        } else {
            phraseEl.style.display = "none";
        }
    }
    updateWordImage(wordObj);
    card.classList.add("visible");
    card.setAttribute("aria-hidden", "false");
    setTimeout(() => {
        card.classList.remove("visible");
        card.setAttribute("aria-hidden", "true");
    }, 900);
}
```

#### æ–‡ä»¶ C: `Game.html`

**ä½ç½®**: è¯å¡åŒºåŸŸï¼ˆæœç´¢ `word-card-zh`ï¼‰

**æ“ä½œ**: åœ¨ `word-card-zh` å…ƒç´ åé¢æ·»åŠ ä¸€è¡Œ:
```html
<div id="word-card-phrase" style="display:none; font-size:12px; color:#FFD54F; margin-top:4px; font-style:italic;"></div>
```

**éªŒè¯**: æ”¶é›†å«æœ‰ phrase çš„å•è¯ï¼ˆå¦‚ kindergarten è¯åº“ä¸­çš„ "smile"ï¼‰ï¼Œè¯å¡åº”æ˜¾ç¤º "Smile happily"ã€‚

---

### Step 3: å­¦ä¹ æ¨¡å¼ç­”é”™ä¸æ‰£åˆ† + é‡è¯•

#### æ–‡ä»¶: `src/modules/12-challenges.js`

**ä½ç½®**: Step 1 ä¸­æ”¹é€ åçš„ `completeLearningChallenge()` çš„ `else` åˆ†æ”¯

**æ“ä½œ**: åœ¨ `else` åˆ†æ”¯å¼€å¤´å¢åŠ å­¦ä¹ æ¨¡å¼åˆ¤æ–­ã€‚

**æ”¹ä¸º**ï¼ˆæ›¿æ¢ else åˆ†æ”¯ï¼‰:
```javascript
    } else {
        // å­¦ä¹ æ¨¡å¼ï¼šä¸æ‰£åˆ†ï¼Œå±•ç¤ºæ­£ç¡®ç­”æ¡ˆåé‡è¯•åŒä¸€ä¸ªè¯
        if (settings.learningMode) {
            showChallengeCorrection(wordObj);
            showFloatingText("ğŸ’¡ å†è¯•ä¸€æ¬¡", player.x, player.y - 40);
            const savedOrigin = challengeOrigin;
            setTimeout(() => {
                hideLearningChallenge();
                currentLearningChallenge = null;
                challengeOrigin = null;
                // åŒä¸€ä¸ªè¯é‡æ–°å‡ºé¢˜ï¼ˆæ¢ä¸ªé¢˜å‹ï¼‰
                startLearningChallenge(wordObj, null, savedOrigin);
            }, 2500);
            return;
        }
        // éå­¦ä¹ æ¨¡å¼ï¼šæ‰£åˆ† + å±•ç¤ºæ­£ç¡®ç­”æ¡ˆ
        addScore(-reward.wrong.scorePenalty);
        showFloatingText("âŒ æŒ‘æˆ˜å¤±è´¥", player.x, player.y - 40);
        if (challengeOrigin && challengeOrigin instanceof WordGate) {
            challengeOrigin.cooldown = 180;
        }
        showChallengeCorrection(wordObj);
        setTimeout(() => {
            hideLearningChallenge();
            paused = challengePausedBefore;
            currentLearningChallenge = null;
            challengeOrigin = null;
        }, 2000);
        return;
    }
```

**éªŒè¯**:
1. å¼€å¯å­¦ä¹ æ¨¡å¼ï¼Œç­”é”™åä¸æ‰£åˆ†ï¼Œæ˜¾ç¤º "ğŸ’¡ å†è¯•ä¸€æ¬¡"ï¼Œ2.5 ç§’åè‡ªåŠ¨å‡ºæ–°é¢˜ï¼ˆåŒä¸€ä¸ªè¯ï¼‰ã€‚
2. å…³é—­å­¦ä¹ æ¨¡å¼ï¼Œç­”é”™åæ‰£åˆ†ï¼Œæ˜¾ç¤ºæ­£ç¡®ç­”æ¡ˆï¼Œ2 ç§’åå…³é—­ã€‚

---

## éªŒè¯æ­¥éª¤

### A. ç­”é”™æ­£å‘å¼•å¯¼éªŒè¯

1. è¿›å…¥æ¸¸æˆï¼Œè§¦å‘å­¦ä¹ æŒ‘æˆ˜ï¼Œæ•…æ„ç­”é”™ã€‚
2. ç¡®è®¤é¢æ¿ä¸ç«‹å³æ¶ˆå¤±ï¼Œæ˜¾ç¤ºæ­£ç¡®ç­”æ¡ˆï¼ˆè‹±æ–‡ = ä¸­æ–‡ï¼‰ã€‚
3. ç¡®è®¤æ’­æ”¾äº†æ­£ç¡®å‘éŸ³ã€‚
4. ç¡®è®¤ 2 ç§’åé¢æ¿è‡ªåŠ¨å…³é—­ï¼Œæ¸¸æˆæ¢å¤ã€‚
5. ç¡®è®¤ç­”å¯¹æ—¶è¡Œä¸ºä¸å˜ï¼ˆç«‹å³å…³é—­ + åŠ åˆ†ï¼‰ã€‚

### B. ä¾‹å¥å±•ç¤ºéªŒè¯

1. ä½¿ç”¨ kindergarten è¯åº“ï¼ˆå« phrase æ•°æ®ï¼‰ã€‚
2. æ”¶é›†å•è¯æ—¶ï¼Œè¯å¡åº”æ˜¾ç¤ºä¾‹å¥ï¼ˆå¦‚ "Smile happily"ï¼‰ã€‚
3. ä½¿ç”¨ä¸å« phrase çš„å•è¯ï¼Œç¡®è®¤ä¾‹å¥åŒºåŸŸéšè—ã€‚

### C. å­¦ä¹ æ¨¡å¼é‡è¯•éªŒè¯

1. è®¾ç½®ä¸­å¼€å¯å­¦ä¹ æ¨¡å¼ã€‚
2. è§¦å‘æŒ‘æˆ˜ï¼Œæ•…æ„ç­”é”™ï¼Œç¡®è®¤ä¸æ‰£åˆ†ã€‚
3. ç¡®è®¤æ˜¾ç¤º "ğŸ’¡ å†è¯•ä¸€æ¬¡" åè‡ªåŠ¨é‡æ–°å‡ºé¢˜ã€‚
4. ç¬¬äºŒæ¬¡ç­”å¯¹ï¼Œç¡®è®¤æ­£å¸¸åŠ åˆ†ã€‚
5. å…³é—­å­¦ä¹ æ¨¡å¼ï¼Œç­”é”™ç¡®è®¤æ‰£åˆ† + æ˜¾ç¤ºæ­£ç¡®ç­”æ¡ˆã€‚

### D. å›å½’éªŒè¯ï¼ˆå¿…é¡»ï¼‰

1. é¦–é¡µé¦–æ¬¡è¿›å…¥ä¸é‡è¿›ååœ°é¢æŒç»­å¯è§ã€‚
2. è§¦æ§æŒ‰é’®ä¸ä¸¢å¤±å“åº”ã€‚
3. BOSS ä¸æ‘åº„è§¦å‘é“¾è·¯ä¸å›å½’ã€‚
4. è¯è¯­é—¸é—¨ï¼ˆWordGateï¼‰ç­”é”™åå†·å´æ­£å¸¸ã€‚

---

## ç‰ˆæœ¬å‘å¸ƒæ­¥éª¤

```bash
# 1. æ›´æ–°ç‰ˆæœ¬å·
# apk/package.json â†’ "version": "1.12.0"
# apk/android-app/package.json â†’ "version": "1.12.0"
# build.gradle â†’ versionName "1.12.0", versionCode 90

# 2. æ›´æ–°ç‰ˆæœ¬æ–‡æ¡£
# docs/version/CHANGELOG.md â†’ è¿½åŠ  v1.12.0 æ¡ç›®
# docs/version/Progress.md â†’ è¿½åŠ  v1.12.0 æ¡ç›®

# 3. æäº¤
git add src/modules/12-challenges.js src/modules/09-vocab.js Game.html
git add apk/package.json apk/android-app/package.json
git add docs/version/CHANGELOG.md docs/version/Progress.md
git commit -m "feat(v1.12.0): add answer correction feedback, phrase display, learning mode retry"

# 4. æ¨é€
push.bat
```

---

## CHANGELOG æ¡ç›®ï¼ˆé¢„å†™ï¼‰

```markdown
## v1.12.0 (2026-02-xx)

### å­¦ä¹ ä½“éªŒ
- ç­”é”™åå±•ç¤ºæ­£ç¡®ç­”æ¡ˆ + æ’­æ”¾å‘éŸ³ï¼Œ2 ç§’åè‡ªåŠ¨å…³é—­
- è¯å¡æ–°å¢ä¾‹å¥å±•ç¤ºï¼ˆåˆ©ç”¨è¯åº“å·²æœ‰ phrase æ•°æ®ï¼‰
- å­¦ä¹ æ¨¡å¼ä¸‹ç­”é”™ä¸æ‰£åˆ†ï¼Œè‡ªåŠ¨é‡è¯•åŒä¸€å•è¯
```

---

*ç¼–åˆ¶æ—¥æœŸï¼š2026-02-16*
