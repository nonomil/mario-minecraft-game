# 游戏优化-0218 需求清单

日期：2026-02-18

## 需求 1：村庄系统升级

村庄建筑辨识度不足、区域感弱，需要升级为多房屋、可进入、具备床位回血的区域体验。

- 为村庄设计多种建筑外观（方块堆积的房屋群，有区域感和高度层次）
- 可以进入房屋，房子里面有床，躺下去可以回血
- 建筑与宝箱等其他实体在视觉上有明确区分

当前现状（代码审查）：
- 村庄已有矩形墙体 + 三角屋顶 + 门窗 + emoji 图标的渲染，并非"和宝箱一样"
- 核心问题是建筑尺寸偏小（80×60px）、4 种建筑线性排列、缺乏区域感
- 休息回血已实现（靠近建筑触发），但无室内状态，需改为"进入房屋后躺床"

## 需求 2：触控按钮布局优化

- 平板模式：当前按钮布局已可用，保持底部不变
- 手机模式：左右操作按钮需上移至屏幕 Y 轴中间区域，方便单手持握
- 优先自动检测设备类型（phone/tablet），同时在设置中提供手动切换

当前现状（代码审查）：
- 触控布局完全在 `16-events.js` + `styles.css` 中，硬编码 `bottom: 20px`
- `defaults.js` 有 `deviceMode` 字段但未联动布局
- `09-vocab.js` 不涉及触控逻辑

## 需求 3：蘑菇岛崩溃 Bug（已修复 ✅）

进入蘑菇岛后弹窗报错：
> A fatal error occurred. The game is paused. Please reload.
> ReferenceError: take is not defined at spawnEnemyByDifficulty

根因：`11-game-init.js` 中 `spawnEnemyByDifficulty` 函数的 `if` 分支（enemyTiers 路径）在 fallback 时引用了仅在 `else` 分支定义的 `take` 变量。蘑菇岛有 `enemyTiers` 配置，走 `if` 分支时 `tierTypes` 为空触发 fallback，导致 ReferenceError。

修复内容：
- 在 `if` 分支内就地计算 `tierTake`，不再跨分支引用
- 补充 `biomePools` 中缺失的 `mushroom_island` 敌人池（`spore_bug`, `bee`, `fox`）
- 同步修复 `apk/src/modules/11-game-init.js` 和 `src/modules/11-game-init.js`

---

关联文档：
- [综述与执行计划](游戏优化-0218-综述与执行计划.md)
- [Step-by-Step 执行清单](游戏优化-0218-step-by-step执行清单.md)